<html><head><base href="." />
<meta charset="UTF-8">
<title>PurpleTube - Share Your Videos</title>
<style>
:root {
  --purple-primary: #8e24aa;
  --purple-secondary: #ab47bc;
  --purple-light: #e1bee7;
  --bg-color: #fafafa;
  --card-bg: white;
  --text-color: #2c2c2c;
  --text-secondary: #666;
  --border-color: #eee;
  --shadow-color: rgba(0,0,0,0.1);
  --transition: all 0.3s ease;
}

:root[data-theme="dark"] {
  --bg-color: #121212;
  --card-bg: #1e1e1e;
  --text-color: #fff;
  --text-secondary: #aaa;
  --border-color: #333;
  --shadow-color: rgba(0,0,0,0.3);
}

body {
  margin: 0;
  font-family: 'Roboto', sans-serif;
  background: var(--bg-color);
  color: var(--text-color);
}

.navbar {
  background: linear-gradient(45deg, var(--purple-primary), var(--purple-secondary));
  padding: 1rem 2rem;
  transition: var(--transition);
}

.logo {
  font-size: 1.8rem;
  letter-spacing: 0.5px;
}

.logo svg {
  width: 36px;
  height: 36px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
}

.main-content {
  max-width: 1200px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.upload-section {
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px var(--shadow-color);
  margin-bottom: 2rem;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
}

.video-card {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 5px var(--shadow-color);
  transition: var(--transition);
  transform-origin: center;
}

.video-card:hover {
  transform: translateY(-5px) scale(1.02);
  box-shadow: 0 8px 16px var(--shadow-color);
}

.video-preview {
  width: 100%;
  height: 200px;
  background: #ddd;
  position: relative;
}

.video-info {
  padding: 1.5rem;
}

.upload-btn, .theme-btn {
  background: linear-gradient(45deg, var(--purple-primary), var(--purple-secondary));
  padding: 0.8rem 1.8rem;
  border: none;
  border-radius: 25px;
  color: white;
  cursor: pointer;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: var(--transition);
  text-transform: uppercase;
  font-size: 0.9rem;
}

.upload-btn:hover, .theme-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px var(--shadow-color);
}

#video-upload {
  display: none;
}

.progress-bar {
  width: 100%;
  height: 4px;
  background: var(--purple-light);
  margin-top: 1rem;
  border-radius: 2px;
  overflow: hidden;
  display: none;
}

.progress {
  width: 0%;
  height: 100%;
  background: var(--purple-secondary);
  transition: width 0.3s;
}

.storage-info {
  background: var(--card-bg);
  padding: 1rem;
  border-radius: 8px;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.storage-bar {
  flex-grow: 1;
  height: 8px;
  background: var(--purple-light);
  border-radius: 4px;
  overflow: hidden;
}

.storage-used {
  width: 0%;
  height: 100%;
  background: var(--purple-secondary);
}

.channel-section {
  margin-top: 2rem;
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px var(--shadow-color);
}

.channel-header {
  display: flex;
  align-items: center;
  gap: 2rem;
  margin-bottom: 2rem;
}

.channel-avatar {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: var(--purple-light);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  color: var(--purple-primary);
}

.channel-info h1 {
  margin: 0;
  color: var(--purple-primary);
}

.channel-stats {
  display: flex;
  gap: 2rem;
  margin-top: 0.5rem;
  color: var(--text-secondary);
}

.channel-tabs {
  display: flex;
  gap: 1rem;
  border-bottom: 2px solid var(--purple-light);
  margin-bottom: 2rem;
}

.channel-tab {
  padding: 0.5rem 1rem;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
}

.channel-tab.active {
  border-bottom: 2px solid var(--purple-primary);
  color: var(--purple-primary);
  font-weight: 500;
}

.channel-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 8px;
  width: 100%;
  max-width: 500px;
}

.modal-content input {
  width: 100%;
  padding: 0.8rem;
  margin: 1rem 0;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.modal-buttons {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 1rem;
}

.home-link {
  color: white;
  text-decoration: none;
}

.home-section {
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 8px;
  box-shadow: 0 2px 5px var(--shadow-color);
  margin-bottom: 2rem;
}

.shorts-section {
  margin-top: 2rem;
}

.shorts-section .video-card {
  max-width: 400px;
}

.shorts-section .video-preview {
  aspect-ratio: 9/16;
  height: auto;
}

.section-title {
  font-size: 2rem;
  margin-bottom: 2rem;
  position: relative;
  display: inline-block;
}

.section-title:after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 60%;
  height: 4px;
  background: linear-gradient(45deg, var(--purple-primary), var(--purple-secondary));
  border-radius: 2px;
}

.video-meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 1rem 0;
}

.channel-name {
  background: linear-gradient(45deg, var(--purple-primary), var(--purple-secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 600;
}

.video-stats {
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.video-timestamp {
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.video-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--border-color);
}

.like-btn, .dislike-btn {
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--text-secondary);
}

.like-btn:hover, .dislike-btn:hover {
  color: var(--purple-primary);
}

.like-btn.active, .dislike-btn.active {
  color: var(--purple-primary);
}

.toggle-comments-btn {
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--text-secondary);
}

.toggle-comments-btn:hover {
  color: var(--purple-primary);
}

.comments-section {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--border-color);
}

.comment-input {
  border: 2px solid var(--border-color);
  border-radius: 8px;
  padding: 1rem;
  transition: var(--transition);
}

.comment-input:focus {
  border-color: var(--purple-primary);
  outline: none;
  box-shadow: 0 0 0 3px var(--purple-light);
}

.comment {
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0;
  background: var(--bg-color);
  transition: var(--transition);
}

.comment:hover {
  transform: translateX(5px);
}

.loading {
  background: linear-gradient(90deg, 
    var(--card-bg) 25%, 
    var(--border-color) 50%, 
    var(--card-bg) 75%
  );
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.subscribe-btn {
  background: var(--purple-primary);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: var(--transition);
}

.subscribe-btn:hover {
  background: var(--purple-secondary);
  transform: translateY(-2px);
}

.subscriber-count {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-left: 0.5rem;
}

.delete-video-btn {
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: #ff4444;
  padding: 0.5rem;
  border-radius: 4px;
  transition: var(--transition);
}

.delete-video-btn:hover {
  background: rgba(255, 68, 68, 0.1);
  transform: scale(1.05);
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>

<nav class="navbar">
  <div class="logo">
    <a href="index.html" class="home-link">
      <svg viewBox="0 0 24 24" fill="white">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
      </svg>
      PurpleTube
    </a>
  </div>
  <div>
    <button class="theme-btn upload-btn" onclick="toggleTheme()">
      <span id="theme-icon">üåô</span>
    </button>
    <button class="upload-btn" onclick="openCreateChannel()">Create Channel</button>
    <button class="upload-btn" onclick="document.getElementById('video-upload').click()">
      Upload Video
    </button>
    <input type="file" id="video-upload" accept="video/*" onchange="handleVideoUpload(this.files)">
  </div>
</nav>

<div class="main-content">
  <div class="home-section">
    <h2 class="section-title">Recent Videos</h2>
    <div class="video-grid" id="all-videos-container">
      <!-- Videos from all channels will be displayed here -->
    </div>
  </div>
  <div class="home-section shorts-section">
    <h2 class="section-title">Shorts</h2>
    <div class="video-grid" id="shorts-container">
      <!-- Shorts will be displayed here -->
    </div>
  </div>
</div>

<div class="channel-modal" id="channelModal">
  <div class="modal-content">
    <h2>Create New Channel</h2>
    <input type="text" id="channelName" placeholder="Channel Name">
    <input type="text" id="channelDescription" placeholder="Channel Description">
    <div class="modal-buttons">
      <button class="upload-btn" onclick="closeCreateChannel()">Cancel</button>
      <button class="create-channel-btn" onclick="createChannel()">Create</button>
    </div>
  </div>
</div>

<script>
const room = new WebsimSocket();

const PROHIBITED_CONTENT = {
  minDuration: 0,
  maxDuration: 3600,
  prohibitedWords: ['badword1', 'badword2'],
  maxFileSize: 500 * 1024 * 1024,
  shortsMaxDuration: 300 
};

async function verifyVideo(file) {
  return new Promise((resolve, reject) => {
    if (file.size > PROHIBITED_CONTENT.maxFileSize) {
      reject('Video file is too large (max 500MB)');
      return;
    }
    
    const video = document.createElement('video');
    video.preload = 'metadata';
    
    video.onloadedmetadata = () => {
      if (video.duration < PROHIBITED_CONTENT.minDuration) {
        reject('Video is too short');
        return;
      }
      
      if (video.duration > PROHIBITED_CONTENT.maxDuration) {
        reject('Video is too long (max 1 hour)');
        return;
      }

      resolve(video.duration);
    };

    video.onerror = () => {
      reject('Invalid video format');
    };

    video.src = URL.createObjectURL(file);
  });
}
const videoStorage = {
  maxSize: 50 * 1024 * 1024 * 1024,
  usedSize: 0,
  videos: [],
  channels: {},
  subscriptions: {}
};

room.store.get('theme').then(theme => {
  if (theme) {
    document.documentElement.setAttribute('data-theme', theme);
    updateThemeIcon(theme);
  }
});

room.store.get('videos').then(videos => {
  if (!videos) {
    room.store.update({
      id: 'videos',
      dependencies: {},
      updateFunction: () => []
    });
  } else {
    videoStorage.videos = videos;
    displayAllVideos();
  }
});

room.store.get('subscriptions').then(subscriptions => {
  if (subscriptions) {
    videoStorage.subscriptions = subscriptions;
  }
});

async function handleVideoUpload(files) {
  const file = files[0];
  if (!file) return;

  if (file.size + videoStorage.usedSize > videoStorage.maxSize) {
    alert('Not enough storage space!');
    return;
  }

  const uploadBtn = document.querySelector('.upload-btn');
  uploadBtn.disabled = true;
  uploadBtn.textContent = 'Verifying...';

  try {
    const duration = await verifyVideo(file);
    
    const videoName = file.name.toLowerCase();
    const hasProhibitedWords = PROHIBITED_CONTENT.prohibitedWords.some(word => 
      videoName.includes(word.toLowerCase())
    );

    if (hasProhibitedWords) {
      throw new Error('Video title contains prohibited words');
    }

    uploadBtn.textContent = 'Uploading...';
    const videoUrl = await websim.upload(file);
    const username = room.party.client.username;
    
    const videoData = {
      name: file.name,
      size: file.size,
      type: file.type,
      url: videoUrl,
      uploadDate: new Date(),
      channelName: videoStorage.channels[username]?.name || username,
      views: 0,
      likedBy: [],
      dislikedBy: [],
      uploader: username,
      title: file.name,
      description: '',
      likes: 0,
      dislikes: 0,
      comments: [],
      viewedBy: [],
      id: Date.now().toString(),
      verified: true,
      duration: duration
    };

    room.store.update({
      id: 'videos',
      dependencies: { videoData },
      updateFunction: (videos = []) => [...videos, videoData]
    });

    updateStorageInfo(file.size);
    alert('Video uploaded successfully!');

  } catch (error) {
    console.error('Error:', error);
    alert(error.message || 'Failed to upload video: ' + error);
  } finally {
    uploadBtn.disabled = false;
    uploadBtn.textContent = 'Upload Video';
  }
}

async function subscribeToChannel(channelOwner) {
  const username = room.party.client.username;
  
  await room.store.update({
    id: 'channels',
    dependencies: { username, channelOwner },
    updateFunction: (channels = {}) => {
      if (!channels[channelOwner]) return channels;
      
      return {
        ...channels,
        [channelOwner]: {
          ...channels[channelOwner],
          subscribers: (channels[channelOwner].subscribers || 0) + 1
        }
      };
    }
  });

  await room.store.update({
    id: 'subscriptions',
    dependencies: { username, channelOwner },
    updateFunction: (subscriptions = {}) => ({
      ...subscriptions,
      [username]: [...(subscriptions[username] || []), channelOwner]
    })
  });

  displayAllVideos();
}

async function unsubscribeFromChannel(channelOwner) {
  const username = room.party.client.username;
  
  await room.store.update({
    id: 'channels',
    dependencies: { username, channelOwner },
    updateFunction: (channels = {}) => {
      if (!channels[channelOwner]) return channels;
      
      return {
        ...channels,
        [channelOwner]: {
          ...channels[channelOwner],
          subscribers: Math.max(0, (channels[channelOwner].subscribers || 0) - 1)
        }
      };
    }
  });

  await room.store.update({
    id: 'subscriptions',
    dependencies: { username, channelOwner },
    updateFunction: (subscriptions = {}) => ({
      ...subscriptions,
      [username]: (subscriptions[username] || []).filter(ch => ch !== channelOwner)
    })
  });

  displayAllVideos();
}

async function handleSubscribe(channelOwner) {
  const username = room.party.client.username;
  const isSubscribed = videoStorage.subscriptions[username]?.includes(channelOwner);
  
  if (isSubscribed) {
    await unsubscribeFromChannel(channelOwner);
  } else {
    await subscribeToChannel(channelOwner);
  }
}

function handleLike(videoId) {
  const username = room.party.client.username;

  room.store.update({
    id: 'videos',
    dependencies: { videoId, username },
    updateFunction: (videos = []) => {
      return videos.map(v => {
        if (v.id === videoId) {
          if (v.likedBy.includes(username)) {
            return {
              ...v,
              likes: v.likes - 1,
              likedBy: v.likedBy.filter(u => u !== username)
            };
          }
          if (v.dislikedBy.includes(username)) {
            return {
              ...v,
              likes: v.likes + 1,
              dislikes: v.dislikes - 1,
              likedBy: [...v.likedBy, username],
              dislikedBy: v.dislikedBy.filter(u => u !== username)
            };
          }
          return {
            ...v,
            likes: v.likes + 1,
            likedBy: [...v.likedBy, username]
          };
        }
        return v;
      });
    }
  });
}

function handleDislike(videoId) {
  const username = room.party.client.username;

  room.store.update({
    id: 'videos',
    dependencies: { videoId, username },
    updateFunction: (videos = []) => {
      return videos.map(v => {
        if (v.id === videoId) {
          if (v.dislikedBy.includes(username)) {
            return {
              ...v,
              dislikes: v.dislikes - 1,
              dislikedBy: v.dislikedBy.filter(u => u !== username)
            };
          }
          if (v.likedBy.includes(username)) {
            return {
              ...v,
              likes: v.likes - 1,
              dislikes: v.dislikes + 1,
              dislikedBy: [...v.dislikedBy, username],
              likedBy: v.likedBy.filter(u => u !== username)
            };
          }
          return {
            ...v,
            dislikes: v.dislikes + 1,
            dislikedBy: [...v.dislikedBy, username]
          };
        }
        return v;
      });
    }
  });
}

function handleVideoPlay(videoId) {
  const username = room.party.client.username;

  room.store.update({
    id: 'videos',
    dependencies: { videoId, username },
    updateFunction: (videos = []) => {
      return videos.map(v => {
        if (v.id === videoId && !v.viewedBy.includes(username)) {
          return {
            ...v,
            views: v.views + 1,
            viewedBy: [...v.viewedBy, username]
          };
        }
        return v;
      });
    }
  });
}

async function deleteVideo(videoId) {
  if (!confirm('Are you sure you want to delete this video? This action cannot be undone.')) {
    return;
  }

  const video = videoStorage.videos.find(v => v.id === videoId);
  
  if (video.uploader !== room.party.client.username) {
    alert('You can only delete your own videos!');
    return;
  }

  videoStorage.usedSize -= video.size;

  await room.store.update({
    id: 'videos',
    dependencies: { videoId },
    updateFunction: (videos = []) => videos.filter(v => v.id !== videoId)
  });

  displayAllVideos();
}

function displayAllVideos() {
  const allVideosContainer = document.getElementById('all-videos-container');
  const shortsContainer = document.getElementById('shorts-container');
  allVideosContainer.innerHTML = '';
  shortsContainer.innerHTML = '';

  const sortedVideos = videoStorage.videos.sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));

  sortedVideos.forEach(video => {
    const isShort = video.duration <= PROHIBITED_CONTENT.shortsMaxDuration;
    const container = isShort ? shortsContainer : allVideosContainer;
    
    const videoCard = document.createElement('div');
    videoCard.className = 'video-card';

    videoCard.innerHTML = `
      <div class="video-preview">
        <video width="100%" height="100%" controls onplay="handleVideoPlay('${video.id}')">
          <source src="${video.url}" type="${video.type}">
          Your browser does not support the video tag.
        </video>
      </div>
      <div class="video-info">
        <h3>${video.title}</h3>${video.verified ? '<span style="color: green; font-size: 0.8em;">‚úì Verified</span>' : ''}
        <p>${video.description || ''}</p>
        <div class="video-meta">
          <span class="channel-name">${videoStorage.channels[video.uploader]?.name || video.uploader}</span>
          <span class="subscriber-count">${videoStorage.channels[video.uploader]?.subscribers || 0} subscribers</span>
          ${video.uploader !== room.party.client.username ? `
            <button class="subscribe-btn" onclick="handleSubscribe('${video.uploader}')">
              ${videoStorage.subscriptions[room.party.client.username]?.includes(video.uploader) ? 'Unsubscribe' : 'Subscribe'}
            </button>
          ` : ''}
        </div>

        <div class="video-stats">
          <span>${formatViews(video.views)} views</span>
          <span>‚Ä¢</span>
          <span class="video-timestamp">${formatUploadDate(video.uploadDate)}</span>
        </div>
        <div class="video-actions">
          <button class="like-btn ${video.likedBy?.includes(room.party.client.username) ? 'active' : ''}" onclick="handleLike('${video.id}')">
            üëç ${video.likes}
          </button>
          <button class="dislike-btn ${video.dislikedBy?.includes(room.party.client.username) ? 'active' : ''}" onclick="handleDislike('${video.id}')">
            üëé ${video.dislikes}
          </button>
          ${video.uploader === room.party.client.username ? `
            <button class="edit-video-btn" onclick="editVideo('${video.id}')">
              Edit
            </button>
            <button class="delete-video-btn" onclick="deleteVideo('${video.id}')">
              üóëÔ∏è Delete
            </button>
          ` : ''}
          <button class="toggle-comments-btn" onclick="toggleComments('${video.id}')">
            üí¨ Comments (${video.comments.length})
          </button>
        </div>
        <div class="comments-section" id="comments-${video.id}" style="display: none;">
          <input type="text" 
                 class="comment-input" 
                 placeholder="Add a comment..."
                 onkeypress="handleCommentInput(event, '${video.id}')">
          <div class="comments">
            ${video.comments.map(comment => `
              <div class="comment">
                <div class="comment-header">
                  <span class="comment-author">${comment.author}</span>
                  <span class="comment-date">${formatUploadDate(comment.date)}</span>
                </div>
                <div class="comment-text">${comment.text}</div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
    `;
    
    container.appendChild(videoCard);
  });
}

function toggleComments(videoId) {
  const commentsSection = document.getElementById(`comments-${videoId}`);
  commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
}

function formatViews(views) {
  if (views >= 1000000) {
    return (views / 1000000).toFixed(1) + 'M';
  } else if (views >= 1000) {
    return (views / 1000).toFixed(1) + 'K';
  }
  return views;
}

function formatUploadDate(date) {
  const now = new Date();
  const diff = now - new Date(date);
  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  
  if (days > 30) {
    return new Date(date).toLocaleDateString();
  } else if (days > 0) {
    return `${days} day${days > 1 ? 's' : ''} ago`;
  } else if (hours > 0) {
    return `${hours} hour${hours > 1 ? 's' : ''} ago`;
  } else if (minutes > 0) {
    return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
  } else {
    return 'Just now';
  }
}

function updateStorageInfo(fileSize) {
  videoStorage.usedSize += fileSize;
}

function openCreateChannel() {
  document.getElementById('channelModal').style.display = 'flex';
}

function closeCreateChannel() {
  document.getElementById('channelModal').style.display = 'none';
}

async function createChannel() {
  const name = document.getElementById('channelName').value;
  const description = document.getElementById('channelDescription').value;
  
  if (!name) {
    alert('Please enter a channel name');
    return;
  }

  const username = room.party.client.username;

  await room.store.update({
    id: 'channels',
    dependencies: { username, name, description },
    updateFunction: (channels = {}) => ({
      ...channels,
      [username]: {
        name,
        description,
        subscribers: 0,
        totalViews: 0,
        createdAt: new Date()
      }
    })
  });

  videoStorage.channels[username] = {
    name,
    description,
    subscribers: 0,
    totalViews: 0
  };
  
  closeCreateChannel();
}

function handleCommentInput(event, videoId) {
  if (event.key === 'Enter' && event.target.value.trim()) {
    const comment = {
      author: room.party.client.username,
      text: event.target.value.trim(),
      date: new Date()
    };
    
    room.store.update({
      id: 'videos',
      dependencies: { videoId, comment },
      updateFunction: (videos = []) => {
        return videos.map(v => {
          if (v.id === videoId) {
            return { 
              ...v, 
              comments: [...(v.comments || []), comment]
            };
          }
          return v;
        });
      }
    });
    
    event.target.value = '';
  }
}

function editVideo(videoId) {
  const video = videoStorage.videos.find(v => v.id === videoId);
  const newTitle = prompt('Enter new title:', video.title);
  const newDescription = prompt('Enter new description:', video.description);
  
  if (newTitle !== null && newDescription !== null) {
    room.store.update({
      id: 'videos',
      dependencies: { videoId, newTitle, newDescription },
      updateFunction: (videos = []) => {
        return videos.map(v => {
          if (v.id === videoId) {
            return { ...v, title: newTitle, description: newDescription };
          }
          return v;
        });
      }
    });
  }
}

function toggleTheme() {
  const currentTheme = document.documentElement.getAttribute('data-theme');
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  
  document.documentElement.setAttribute('data-theme', newTheme);
  updateThemeIcon(newTheme);
  
  room.store.update({
    id: 'theme',
    dependencies: { newTheme },
    updateFunction: () => newTheme
  });
}

function updateThemeIcon(theme) {
  const icon = document.getElementById('theme-icon');
  icon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
}

window.onload = function() {
  displayAllVideos();
};
</script>

</body>
</html>